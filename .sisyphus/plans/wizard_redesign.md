# ç»“æ„åŒ–å‘å¯¼é‡è®¾è®¡æ–¹æ¡ˆ

## è®¾è®¡ç›®æ ‡
å°† StructuredWizard æ”¹é€ ä¸º**çœŸæ­£çš„ Prompt æ‰§è¡Œå™¨**ï¼Œè€Œéç®€å•çš„æ¨¡æ¿å±•ç¤ºã€‚

---

## æ ¸å¿ƒæ¶æ„

### æ–°ç»„ä»¶ç»“æ„
```
StructuredWizard/
â”œâ”€â”€ PromptExecutor.tsx      # æ ¸å¿ƒæ‰§è¡Œå™¨ç»„ä»¶
â”œâ”€â”€ VariableForm.tsx        # åŠ¨æ€è¡¨å•ï¼ˆæ ¹æ® prompt å˜é‡ç”Ÿæˆï¼‰
â”œâ”€â”€ OutputViewer.tsx        # AI è¾“å‡ºå±•ç¤ºï¼ˆæ”¯æŒ JSON è§£æï¼‰
â”œâ”€â”€ PipelineFlow.tsx        # æµæ°´çº¿è¿›åº¦å±•ç¤º
â””â”€â”€ utils/
    â”œâ”€â”€ promptParser.ts     # è§£æ {{variable}} å ä½ç¬¦
    â””â”€â”€ variableResolver.ts # æ›¿æ¢å˜é‡å¹¶ç»„è£… prompt
```

---

## äº¤äº’æµç¨‹è®¾è®¡

### Step 1: é€‰æ‹©å·¥ä½œæµ
ç”¨æˆ·é€‰æ‹©"æ›¿èº«æ–‡æµç¨‹"ç­‰å·¥ä½œæµé…ç½®

### Step 2: é€‰æ‹© Prompt æ¨¡æ¿
å±•ç¤ºè¯¥å·¥ä½œæµå¯¹åº”çš„ prompt åˆ—è¡¨ï¼ˆå¦‚"çµæ„Ÿæ•æ‰"ï¼‰

### Step 3: å¡«å†™è¾“å…¥å˜é‡
1. ç³»ç»Ÿè§£æ prompt ä¸­çš„ `{{variable}}` å ä½ç¬¦
2. åŠ¨æ€ç”Ÿæˆè¡¨å•å­—æ®µï¼ˆæ ¹æ®å˜é‡åæ¨æ–­ç±»å‹ï¼‰
3. ç”¨æˆ·å¡«å†™è¡¨å•

### Step 4: æ‰§è¡Œ AI å¯¹è¯
1. å°† prompt_content ä½œä¸º System Prompt
2. å°†ç”¨æˆ·å¡«å†™çš„å˜é‡ç»„è£…ä¸º User Message
3. è°ƒç”¨ AI APIï¼ˆ`/api/ai/chat`ï¼‰
4. å®æ—¶æµå¼æ˜¾ç¤º AI å“åº”

### Step 5: ä¿å­˜è¾“å‡ºå¹¶è¿›å…¥ä¸‹ä¸€æ­¥
1. è§£æ AI è¾“å‡ºçš„ JSON
2. ä¿å­˜åˆ° Contextï¼ˆå¯ä¾›åç»­ prompt ä½¿ç”¨ï¼‰
3. è‡ªåŠ¨å¡«å……ä¸‹ä¸€ä¸ª prompt çš„è¾“å…¥å˜é‡

---

## æŠ€æœ¯å®ç°

### 1. å˜é‡è§£æå™¨ (`promptParser.ts`)
```typescript
interface ParsedVariable {
  name: string;           // å˜é‡å
  displayName: string;    // æ˜¾ç¤ºåç§°ï¼ˆä¸­æ–‡ï¼‰
  type: 'text' | 'textarea' | 'json';  // è¾“å…¥ç±»å‹
  required: boolean;
  defaultValue?: string;
}

function parseVariables(promptContent: string): ParsedVariable[];
function resolvePrompt(template: string, values: Record<string, string>): string;
```

### 2. åŠ¨æ€è¡¨å• (`VariableForm.tsx`)
- æ ¹æ® `parseVariables()` ç»“æœåŠ¨æ€æ¸²æŸ“
- æ”¯æŒä» Context è‡ªåŠ¨å¡«å……ï¼ˆä¸Šä¸€æ­¥è¾“å‡ºï¼‰
- æ”¯æŒ JSON ç¼–è¾‘å™¨ï¼ˆå¤æ‚å˜é‡ï¼‰

### 3. AI è°ƒç”¨é›†æˆ
å¤ç”¨ç°æœ‰ `/api/ai/chat` æˆ– `/api/ai/stream` æ¥å£ï¼š
```typescript
const response = await fetch('/api/ai/chat', {
  method: 'POST',
  body: JSON.stringify({
    messages: [
      { role: 'system', content: resolvedPrompt },
      { role: 'user', content: userInput }
    ]
  })
});
```

### 4. Context çŠ¶æ€ç®¡ç†
```typescript
interface WorkflowContext {
  [variableName: string]: string | object;
}

// æ¯æ­¥è¾“å‡ºè‡ªåŠ¨ä¿å­˜åˆ° context
// ä¸‹ä¸€æ­¥å¯ä» context è¯»å–ä½œä¸ºè¾“å…¥
```

---

## UI è‰æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ­ æ›¿èº«æ–‡æµç¨‹                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [1.çµæ„Ÿæ•æ‰] â†’ [2.å¸‚åœºå®šä½] â†’ [3.æ ¸å¿ƒæ¢—] â†’ [4.å¤§çº²]      â”‚
â”‚      â—            â—‹             â—‹           â—‹            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å½“å‰æ­¥éª¤: çµæ„Ÿæ•æ‰                                       â”‚
â”‚  ä½¿ç”¨æ¨¡æ¿: æ›¿èº«æ–‡-å®è§‚-çµæ„Ÿæ•æ‰                            â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ è¾“å…¥å˜é‡                                             â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚ â”‚ çµæ„Ÿæ±  (inspiration_pool)                     â”‚  â”‚â”‚
â”‚  â”‚ â”‚ [å¤šè¡Œæ–‡æœ¬è¾“å…¥...]                              â”‚  â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚ â”‚ ç›®æ ‡è¯»è€…ç”»åƒ (target_reader_profile)          â”‚  â”‚â”‚
â”‚  â”‚ â”‚ [ä»ä¸Šä¸‹æ–‡è‡ªåŠ¨å¡«å…… æˆ– æ‰‹åŠ¨è¾“å…¥]                 â”‚  â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                          â”‚
â”‚  [ğŸš€ æ‰§è¡Œ AI å¯¹è¯]                                        â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ AI è¾“å‡º                                              â”‚â”‚
â”‚  â”‚ {                                                   â”‚â”‚
â”‚  â”‚   "substitute_inspiration_list": [...],             â”‚â”‚
â”‚  â”‚   "inspiration_summary": {...}                      â”‚â”‚
â”‚  â”‚ }                                                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                          â”‚
â”‚  [ä¿å­˜åˆ°ä¸Šä¸‹æ–‡] [è¿›å…¥ä¸‹ä¸€æ­¥ â†’]                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®æ–½è®¡åˆ’

| ä»»åŠ¡ | ä¼˜å…ˆçº§ | å¤æ‚åº¦ |
|------|--------|--------|
| å˜é‡è§£æå™¨ | P0 | ä¸­ |
| åŠ¨æ€è¡¨å•ç»„ä»¶ | P0 | é«˜ |
| AI è°ƒç”¨é›†æˆ | P0 | ä¸­ |
| Context çŠ¶æ€ç®¡ç† | P0 | ä¸­ |
| æµæ°´çº¿è¿›åº¦ UI | P1 | ä½ |
| JSON è¾“å‡ºè§£æå™¨ | P1 | ä¸­ |

---

## é¢„æœŸæ•ˆæœ

1. âœ… ç”¨æˆ·é€‰æ‹© prompt â†’ å¡«å†™å˜é‡ â†’ æ‰§è¡Œ AI å¯¹è¯
2. âœ… AI è¾“å‡ºè‡ªåŠ¨ä¿å­˜ï¼Œå¯ä¾›åç»­æ­¥éª¤ä½¿ç”¨
3. âœ… å®Œæ•´çš„æ›¿èº«æ–‡åˆ›ä½œæµæ°´çº¿
4. âœ… çœŸæ­£å‘æŒ¥ TSC2 prompt çš„è®¾è®¡ä»·å€¼
